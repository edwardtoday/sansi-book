=== 服务器安装与配置

==== Fedora的安装

下载

* http://mirrors.163.com/fedora/releases/19/Live/x86_64/Fedora-Live-Desktop-x86_64-19-1.iso[Fedora镜像]

* https://fedorahosted.org/releases/l/i/liveusb-creator/liveusb-creator-3.12.0-setup.exe[Fedora LiveUSB Creator]

用LiveUSB Creator制作安装U盘，需要U盘分区格式为FAT。Windows 7下可用如下方法建立FAT分区：

1. Win+R打开“运行对话框”，运行cmd
2. 运行diskpart，模仿下列过程选择磁盘、分区，清楚现有分区并新建活动分区格式化为FAT。

NOTE: 例子中的500MB是不够的，建议2G或3G。

[source,bash]
----
DISKPART> list disk

  Disk ###  Status      Size     Free     Dyn  Gpt
  --------  ----------  -------  -------  ---  ---
  Disk 0    Online        40 GB      0 B
  Disk 1    Online      7538 MB      0 B

DISKPART> select disk 1

Disk 1 is now the selected disk.

DISKPART> list part

  Partition ###  Type              Size     Offset
  -------------  ----------------  -------  -------
  Partition 1    Primary            500 MB  1024 KB

DISKPART> clean

DiskPart succeeded in cleaning the disk.

DISKPART> create part primary size=500

DiskPart succeeded in creating the specified partition.

DISKPART> active

DiskPart marked the current partition as active.

DISKPART> format fs=fat quick

  100 percent completed

DiskPart successfully formatted the volume.

DISKPART> assign

DiskPart successfully assigned the drive letter or mount point.
----

默认安装。

==== Server Info

* OS: Fedora 19.1 x86_64
* Server IP: 202.11.20.186
* Server MAC: 2C:41:38:8C:37:81
* root password: qingpei@sansi.com
* admin account: qingpei:123789
* mariadb root password: mariadb@sansi.com

==== Configuration

===== Chinese IME

[source,bash]
----
sudo yum instlall ibus-rime
----

Goto `Settings` -> `Region & Language` -> `Input Sources`, Click the plus
button.

Click the ellipsis at the bottom, search for `Rime`, click `Chinese
(Rime)` under `Chinese (China)` section.

Use Super + Space to switch between input sources.

===== MariaDB

* Installation from repository

[source,bash]
----
sudo yum install mariadb mariadb-libs mariadb-devel mariadb-server
----

* Start server and autostart server on boot:

[source,bash]
----
systemctl start mysqld.service ## use restart after update
 
systemctl enable mysqld.service
----

* Secure Installation

[source,bash]
----
/usr/bin/mysql_secure_installation
----

output:

[source,bash]
----
Enter current password for root (enter for none): 
OK, successfully used password, moving on...

Setting the root password ensures that nobody can log into the MariaDB
root user without the proper authorisation.

Set root password? [Y/n] 
New password: 
Re-enter new password: 
Sorry, passwords do not match.

New password: 
Re-enter new password: 
Password updated successfully!
Reloading privilege tables..
 ... Success!


By default, a MariaDB installation has an anonymous user, allowing anyone
to log into MariaDB without having to have a user account created for
them.  This is intended only for testing, and to make the installation
go a bit smoother.  You should remove them before moving into a
production environment.

Remove anonymous users? [Y/n] 
 ... Success!

Normally, root should only be allowed to connect from 'localhost'.  This
ensures that someone cannot guess at the root password from the network.

Disallow root login remotely? [Y/n] 
 ... Success!

By default, MariaDB comes with a database named 'test' that anyone can
access.  This is also intended only for testing, and should be removed
before moving into a production environment.

Remove test database and access to it? [Y/n] 
 - Dropping test database...
 ... Success!
 - Removing privileges on test database...
 ... Success!

Reloading the privilege tables will ensure that all changes made so far
will take effect immediately.

Reload privilege tables now? [Y/n] 
 ... Success!

Cleaning up...

All done!  If you've completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!
----

* Test connection to database

[source,bash]
----
mysql -h localhost -u root -p
----

You should be able to see the following message after entering the root
password.

[source,bash]
----
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 7
Server version: 5.5.33a-MariaDB MariaDB Server

Copyright (c) 2000, 2013, Oracle, Monty Program Ab and others.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

MariaDB [(none)]>
----

* Installing system tables (mysql_install_db)

`mysql_install_db` is needed to create the system tables in the 'mysql'
database directory. MariaDB uses these tables to manage user rights and
provide the data for the `'help'` command in the mysql client.

[source,bash]
----
sudo systemctl stop mysqld.service
sudo mysql_install_db --user=mysql
----

* Create Database, User and Enable Remote Connections to Database

The example uses following parameters:

* DB_NAME = skyeye_db
* USER_NAME = skyeye_admin
* REMOTE_IP = 202.11.%
* PASSWORD = skyeye@sansi.com
* PERMISSIONS = ALL

[source,sql]
----
## CREATE DATABASE ##
MariaDB [(none)]> CREATE DATABASE skyeye_db;
Query OK, 1 row affected (0.00 sec)

## CREATE USER ##
MariaDB [(none)]> CREATE USER 'skyeye_admin'@'202.11.%' IDENTIFIED BY
               -> 'skyeye@sansi.com' ;
Query OK, 0 rows affected (0.01 sec)

## GRANT PERMISSIONS ##
MariaDB [(none)]> GRANT ALL ON skyeye_db.* TO 'skyeye_admin'@'202.11.%';
Query OK, 0 rows affected (0.02 sec)

##  FLUSH PRIVILEGES, Tell the server TO reload the GRANT TABLES  ##
MariaDB [(none)]> FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)
----

* Enable Remote Connection to MariaDB Server

Open MySQL port (3306) on firewall.

[source,bash]
----
firewall-cmd --permanent --zone=public --add-port=3306/tcp
----

Test remote conntection

[source,bash]
----
mysql -h 202.11.20.186 -u skyeye_admin -p skyeye_db
----

===== 数据库编码设定

因为要支持中文，所以需要改变数据库的默认编码。

[source,bash]
----
 mysql -h localhost -u root -p skyeye_db

MariaDB [skyeye_db]> SET GLOBAL character_set_server = 'utf8';
Query OK, 0 rows affected (0.00 sec)

MariaDB [skyeye_db]> SET GLOBAL character_set_database = 'utf8';
Query OK, 0 rows affected (0.00 sec)

MariaDB [skyeye_db]> SET GLOBAL collation_database = 'utf8_general_ci';
Query OK, 0 rows affected (0.00 sec)

MariaDB [skyeye_db]> SET collation_database = 'utf8_general_ci';
Query OK, 0 rows affected (0.00 sec)

MariaDB [skyeye_db]> SET character_set_database = 'utf8';
Query OK, 0 rows affected (0.00 sec)
----

===== phpMyAdmin

[source,bash]
----
sudo yum -y install phpMyAdmin php-mysql php-mcrypt
----

Edit `/etc/httpd/conf.d/phpMyAdmin.conf`

[source,bash]
------------------------------------
# line 15: add IP address you permit
Require ip 127.0.0.1 202.11.0.0/16

# line 32: add IP address you permit
------------------------------------

Restart httpd.

[source,bash]
sudo systemctl restart httpd.service

Open a browser to access http://202.11.20.186/phpmyadmin/.

Use a valid MariaDB user/password to login.
