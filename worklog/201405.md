**20140504**

1. 异步建立 TCP 连接，用 callback 处理错误。
  - 同步连接如果失败，会阻塞大约20秒（超时）才能获得返回值，不适合多设备批量操作。
2. 调整调用关系，不再用任务队列，读到任务后直接异步调用handler处理。
3. 帮助寻找Windows系统上的 split-horizon DNS 解决方案
  - 刘工在做的OA系统需要把一个域名根据用户的网段解析到内/外网不同的IP地址，Windows Server 2008自带的DNS服务不支持这个功能
  - 可以尝试免费软件： BIND

**20140505**

1. 对于 `设置调光模式` 类型的任务，生成一个 frame 并写到 socket
2. 把 `shared_ptr<Task>` 作为参数不断传递给 handler，完成任务后直接丢弃

**20140506**

1. 数据帧的写队列可以不断 push_back 新的待写帧，但是写完一帧后进入等待状态，直到这一帧被回复或是超时。
  - 这样就可以将回复和记录在数据帧中的 pending task 对应上了
  - 超时则在 pending task 中记录超时错误，并继续处理写队列
2. 写数据帧时，如果尚未连接，等待3秒后重试（共）1次。
3. 对收到的数据帧进行解析

**20140507**

1. 更新数据库的sql语句放在 task 中
  - 设置命令：在生成 task 对象时即可设置
  - 查询命令：在收到回复的时候设置
  - 上报及报警：在收到时设置
2. 修正网络通信逻辑中的问题，现在连续执行多个任务正常了
  - 同时执行多个 `async_connect` 会抛 exception
  - 加 `mutex` 避免这种情况
3. 增加如下任务类型的处理：
  - 控制器时间同步

**20140508**

1. 增加如下任务类型的处理：
  - 设置控制器时控调光计划
  - 清空控制器时控调光计划
2. 重写数据库模块，用C API。
  - C++ connector 的 `getString` 时不时会crash，搜索后发现长度大于16的varchar会出现这个问题
  - 网上提及的多种解决方法我都尝试了一遍，未能解决问题。方法包括
    1. 更改 `Code Generation`->`Runtime Library` 为 `/MD` 和 `/MDd`
    2. 从源码编译C++ Connector
    3. 用 `getBlob` 替代 `getString`
3. 从任务参数获取控制器MAC地址要去除重复的记录，以保证不给控制器发重复的数据帧。

**20140509**

1. 增加如下任务类型的处理：
  - 查询控制器状态
  - 查询控制器时控调光计划
  - 终端设备信息初始化
  - 终端设备信息删除
  - 终端设备调光
  - 终端设备组设置

**TODO**

1. 增加更多任务类型的处理
2. Boost.Log crashes!
